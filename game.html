<!doctype html>
<html lang="cs" class="h-100">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="Jana Kolaja Ehlerová, Michal Puchrík, Zora Krykorková, Kristián Jacik">
    <title>Líný robot &bullet; Noc vědců</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <style>
        .bd-placeholder-img {
            font-size: 1.125rem;
            text-anchor: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        @media (min-width: 768px) {
            .bd-placeholder-img-lg {
                font-size: 3.5rem;
            }
        }
    </style>

    <!-- Custom styles for this template -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@700&family=Manrope:wght@200;300;400&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="css/sticky-footer-navbar.css">

</head>

<body class="d-flex flex-column h-100">
<header>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container justify-content-start">
            <a href="//www.fm.tul.cz" class="mr-auto" rel="external"><img src="assets/logo-fm-cmyk-cz.png" height="50 em" alt="Logo FM TUL"/></a>
            <a href="//www.tojeit.cz" rel="external"><img src="assets/tojeit.png" height="50 em" alt="Logo ToJeIt.cz"/></a>
            <a href="//www.nocvedcu.cz/organizace/technicka-univerzita-v-liberci" class="ml-3" rel="external"><img src="assets/nocvedcu-hero.svg" height="50 em" alt="Logo Noc vědců"/></a>
        </div>
    </nav>
    <nav class="navbar navbar-expand-lg navbar-light" style="background-color: #ddd;">
        <div class="container justify-content-start">
            <span class="navbar-brand header-font">Aktuální úkol:</span>
            <ul class="navbar-nav mr-auto">
                <li class="nav-item">
                    <span class="nav-link">Promíchej zkumavky</span>
                </li>
            </ul>
            <span class="navbar-text">Navbar text with an inline element</span>
        </div>
    </nav>
</header>

<!-- Begin page content -->
<main role="main">

    <img id="robot_head" src="assets/Robot_game/Robot_head.svg" alt="Avatar robota"/>
    <img id="map" src="assets/map.png" usemap="#image-map" alt="Mapa budovy"/>
    <map name="image-map">
        <area data-toggle="tooltip" data-placement="top" id="01081_architekt" alt="01081_architekt" title="Ateliér architektury" href="javascript:roomClick('01081_architekt')" coords="281,276,1785,997" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="01025_domovnik" alt="01025_domovnik" title="Dílna domovníka" href="javascript:roomClick('01025_domovnik')" coords="1299,1003,1995,1437" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="01020_chemie" alt="01020_chemie" title="Chemická laboratoř" href="javascript:roomClick('01020_chemie')" coords="573,1013,1033,1550" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="01014_strojovna" alt="01014_strojovna" title="Strojovna" href="javascript:roomClick('01014_strojovna')" coords="573,1550,1033,1928" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="schody_vchod" alt="schody_vchod" title="Schodiště" href="javascript:roomClick('schody_vchod')" coords="803,2368,1274,2931" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="wc" alt="wc" title="Toalety" href="javascript:roomClick('wc')" coords="1304,1662,2005,1933" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="uklid_1" alt="uklid_1" title="Úklidová místnost" href="javascript:roomClick('uklid_1')" coords="2031,1642,2348,1979" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="01042_elektrotechnici_kancelar" alt="01042_elektrotechnici_kancelar" title="Kancelář elektrotechniků" href="javascript:roomClick('01042_elektrotechnici_kancelar')" coords="1279,2179,1872,2829" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="01043_elektrotechnici_kancelar" alt="01043_elektrotechnici_kancelar" title="Kancelář elektrotechniků" href="javascript:roomClick('01043_elektrotechnici_kancelar')" coords="1882,2174,2261,2823" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="schody_tk3" alt="schody_tk3" title="Robotická laboratoř" href="javascript:roomClick('schody_tk3')" coords="2424,1627,2721,1995" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="01039_tk3" alt="01039_tk3" title="Učebna TK3" href="javascript:roomClick('01039_tk3')" coords="2005,992,3043,1621" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="01081_archiv" alt="01081_archiv" title="Archiv" href="javascript:roomClick('01081_archiv')" coords="2731,1637,3038,1985" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="01044_administrativa_kancelar" alt="01044_administrativa_kancelar" title="Kancelář administrativy" href="javascript:roomClick('01044_administrativa_kancelar')" coords="2256,2179,2629,2818" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="01047_prof_nosek_kancelar" alt="01047_prof_nosek_kancelar" title="Kancelář prof. Noska" href="javascript:roomClick('01047_prof_nosek_kancelar')" coords="3002,2179,3391,2823" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="01048_vedouci_mti" alt="01048_vedouci_mti" title="Vedoucí katedry MTI" href="javascript:roomClick('01048_vedouci_mti')" coords="3401,2179,3785,2823" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="01073_elektrotechnici_kancelar" alt="01073_elektrotechnici_kancelar" title="Kancelář elektrotechniků" href="javascript:roomClick('01073_elektrotechnici_kancelar')" coords="3304,552 3304,1054 3765,1049 3765,808 3637,798 3632,552 " shape="polygon">
        <area data-toggle="tooltip" data-placement="top" id="01075" alt="01075" title="Místnost 01075" href="javascript:roomClick('01075')" coords="3432,1228,3749,1550" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="01076" alt="01076" title="Místnost 01076" href="javascript:roomClick('01076')" coords="3453,1570,3780,1985" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="01072_elektrofyzici_kancelar" alt="01072_elektrofyzici_kancelar" title="Kancelář elektrofyziků" href="javascript:roomClick('01072_elektrofyzici_kancelar')" coords="3642,353,4005,793" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="uklid_2" alt="uklid_2" title="Úklidová místnost" href="javascript:roomClick('uklid_2')" coords="4926,358,5033,588" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="01055_tk8" alt="01055_tk8" title="Učebna TK8" href="javascript:roomClick('01055_tk8')" coords="4517,793,4915,1248" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="01077_knihovna_tk5" alt="Knihovna TK5" title="01077_knihovna_tk5" href="javascript:roomClick('01077_knihovna_tk5')" coords="4025,1263,4496,1627" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="01078_tk6" alt="01078_tk6" title="Učebna TK6" href="javascript:roomClick('01078_tk6')" coords="4020,1627,4496,2164" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="01053_rozvodna" alt="01053_rozvodna" title="Rozvodna" href="javascript:roomClick('01053_rozvodna')" coords="4557,2020,4921,2174" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="01053_ap11" alt="01053_ap11" title="Učebna AP11" href="javascript:roomClick('01053_ap11')" coords="5043,1437,5437,2179" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="01051_ap12" alt="01051_ap12" title="Posluchárna AP12" href="javascript:roomClick('01051_ap12')" coords="4547,2174,5463,2839" shape="rect">
        <!--<area id="map_tk6" alt="" title="TK6" href="javascript:roomClick('tk6')" coords="2021,1003,3024,1607" shape="rect">-->
    </map>
</main>

    <footer class="footer">
        <div class="container">
            <span class="text-muted">2020</span>
        </div>
    </footer>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script>window.jQuery || document.write('<script src="./js/jquery-3.5.1.js"><\/script>')</script>
<script type="text/javascript" src="./js/bootstrap.bundle.min.js"></script>
<script type="text/javascript" src="./js/imageMapResizer.min.js"></script>
<script>
    let currentCoords = { //Relativně k výchozím hodnotám obrázku
        left: 1069,
        top: 2277
    }
    const changeProperties = () => {
            //TODO: Omezit volání jQuery

            console.log("Called resize");
            $('map').imageMapResize();

            //První dva koordináty jsou vzdálenost zleva a vzdálenost shora
            let originalHeight = $('#map')[0].naturalHeight,
                originalWidth = $('#map')[0].naturalWidth,
                currentHeight = $('#map').height(),
                currentWidth = $('#map').width(),
                imageTop = $('#map').offset().top,
                imageLeft = $('#map').offset().left,
                robotHeight = $('#robot_head').height(),
                robotWidth = $('#robot_head').width(),
                scale = {
                    width: currentWidth / originalWidth,
                    height: currentHeight / originalHeight
                };

            //console.log("originalWidth", originalWidth, "originalHeight", originalHeight, "currentWidth", currentWidth, "currentHeight", currentHeight, "scaleWidth", scale.width, "scaleHeight", scale.height, "imageTop", imageTop, "imageLeft", imageLeft);

            console.log("Set coords to", currentCoords);
            // Nejprve nastavit šířku robota, potom jeho koordináty
            $('#robot_head').css({
                width: (scale.width * 300) + "px",
                left: imageLeft + (currentCoords.left * scale.width) - ($('#robot_head').width() / 2) + "px",
                top: imageTop + (currentCoords.top * scale.height) - ($('#robot_head').height() / 2) + "px"
            });

        },
        roomClick = (id) => {
            let originalHeight = $('#map')[0].naturalHeight,
                originalWidth = $('#map')[0].naturalWidth,
                currentHeight = $('#map').height(),
                currentWidth = $('#map').width(),
                imageTop = $('#map').offset().top,
                imageLeft = $('#map').offset().left,
                robotHeight = $('#robot_head').height(),
                robotWidth = $('#robot_head').width(),
                scale = {
                    width: currentWidth / originalWidth,
                    height: currentHeight / originalHeight
                };

            let tk6_coords = {
                left: 2369,
                top: 2047
            }

            console.log(originalHeight, originalWidth, currentHeight, currentWidth, imageTop, imageLeft);
            console.log(scale, "currentLeft", currentCoords.left, "currentTop", currentCoords.top, "newLeft", tk6_coords.left, imageLeft + (tk6_coords.left * scale.width) - ($('#robot_head').width() / 2), "newTop", tk6_coords.top, imageTop + (tk6_coords.top * scale.height) - ($('#robot_head').height() / 2));
            moveHead(imageLeft + (currentCoords.left * scale.width) - ($('#robot_head').width() / 2), imageTop + (currentCoords.top * scale.height) - ($('#robot_head').height() / 2), imageLeft + (tk6_coords.left * scale.width) - ($('#robot_head').width() / 2), imageTop + (tk6_coords.top * scale.height) - ($('#robot_head').height() / 2));
            currentCoords = tk6_coords

        },
        moveHead = (oldLeft, oldTop, newLeft, newTop) => {
            const elem = document.getElementById("robot_head");
            let posLeft = oldLeft,
                posTop = oldTop,
                id = setInterval(manipulate, 5);

            console.log(oldLeft < newLeft)

            function manipulate() {
                //console.log("moving", oldLeft, oldTop, newLeft, newTop, posLeft, posTop);
                //console.log("left", oldLeft < newLeft, oldLeft > newLeft, Math.abs(newLeft - posLeft) >= 1, "top", oldTop < newTop, oldTop > newTop, Math.abs(newTop - posTop) >= 1);

                if (oldLeft < newLeft && Math.abs(newLeft - posLeft) >= 1) {
                    //console.log("moved left");
                    posLeft++;
                    elem.style.left = posLeft + "px";
                } else if (oldLeft > newLeft && Math.abs(newLeft - posLeft) >= 1) {
                    //console.log("moved right");
                    posLeft--;
                    elem.style.left = posLeft + "px";
                } else {
                    //console.log("set final left");
                    posLeft = newLeft;
                    elem.style.left = posLeft + "px";
                }

                if (oldTop < newTop && Math.abs(newTop - posTop) >= 1) {
                    //console.log("moved top");
                    posTop++;
                    elem.style.top = posTop + "px";
                } else if (oldTop > newTop && Math.abs(newTop - posTop) >= 1) {
                    //console.log("moved down");
                    posTop--;
                    elem.style.top = posTop + "px";
                } else {
                    //console.log("set final top");
                    posTop = newTop;
                    elem.style.top = posTop + "px";
                }

                if (posLeft === newLeft && posTop === newTop) {
                    console.log("interval cleared");
                    clearInterval(id);
                }
            }
        };

    window.addEventListener('resize', changeProperties);
    window.addEventListener('load', changeProperties);
    window.addEventListener('mousemove', e => {
        let tooltip = $("div[id^='tooltip']");
        if (tooltip.length > 0) {
            let mouseX = e.pageX;
            let mouseY = e.pageY;
            tooltip.css({left: mouseX, top: mouseY, transform: "translate3d(-" + tooltip[0].firstChild.style.left +", -50px, 0px)", "pointer-events": "none"});
        }
    });

    $(document).ready(() => { //Při načtení dokumentu
        window.setTimeout(changeProperties, 50);
        $('[data-toggle="tooltip"]').tooltip();
    });

    // //Tooltipy nad místnostmi
    // $('[data-toggle="tooltip"]').on('mousemove', function(e) {
    //
    //     let tooltip = $("#" + $(this).attr("TooltipId"));
    //     tooltip.css({
    //         top: e.pageY,
    //         left: e.pageX
    //     });
    //
    //     tooltip.tooltip('show');
    //     // $(".tooltip-inner").css({
    //     //     "background-color": $(this).attr("TooltipBackround")
    //     // });
    //     let a = (tooltip.attr("data-placement") !== "") ? tooltip.attr("data-placement") : "top";
    //     // $(".tooltip-arrow").css("border-" + a + "-color", $(this).attr("TooltipBackround"));
    // });
    //
    // $('[data-toggle="tooltip"]').on('mouseleave', function(e) {
    //     $("#" + $(this).attr("TooltipId")).tooltip('hide')
    // });

    console.log("Added events");
</script>

</body>
</html>
