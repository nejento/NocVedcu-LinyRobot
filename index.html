<!doctype html>
<html lang="cs" class="h-100">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="Jana Kolaja Ehlerová, Michal Puchrík, Zora Krykorková, Kristián Jacik">
    <title>Líný robot &bullet; Noc vědců</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <style>
        .bd-placeholder-img {
            font-size: 1.125rem;
            text-anchor: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        @media (min-width: 768px) {
            .bd-placeholder-img-lg {
                font-size: 3.5rem;
            }
        }
    </style>

    <!-- Custom styles for this template -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@700&family=Manrope:wght@200;300;400&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="css/sticky-footer-navbar.css">

</head>

<body class="d-flex flex-column h-100">
<header>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container justify-content-start">
            <a href="//www.fm.tul.cz" class="mr-auto" rel="external"><img src="assets/logo-fm-cmyk-cz.png" height="50 em" alt="Logo FM TUL"/></a>
            <a href="//www.tojeit.cz" rel="external"><img src="assets/tojeit.png" height="50 em" alt="Logo ToJeIt.cz"/></a>
            <a href="//www.nocvedcu.cz/organizace/technicka-univerzita-v-liberci" class="ml-3" rel="external"><img src="assets/nocvedcu-hero.svg" height="50 em" alt="Logo Noc vědců"/></a>
        </div>
    </nav>
    <nav class="navbar navbar-expand-lg navbar-light" style="background-color: #ddd;">
        <div class="container justify-content-start">
            <span class="navbar-brand header-font">Aktuální úkol:</span>
            <ul class="navbar-nav mr-auto">
                <li class="nav-item">
                    <span class="nav-link">Promíchej zkumavky</span>
                </li>
            </ul>
            <span class="navbar-text">Navbar text with an inline element</span>
        </div>
    </nav>
</header>

<!-- Begin page content -->
<main role="main">

    <img id="robot_head" src="assets/Robot_game/Robot_head.svg" alt="Avatar robota"/>
    <img id="map" src="assets/map.png" usemap="#image-map" alt="Mapa budovy"/>
    <map name="image-map">
        <area data-toggle="tooltip" data-placement="top" id="a01081_architekt" alt="a01081_architekt" title="Ateliér architektury" href="javascript:roomClick('a01081_architekt')" coords="281,276,1785,997" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="a01025_domovnik" alt="a01025_domovnik" title="Dílna domovníka" href="javascript:roomClick('a01025_domovnik')" coords="1299,1003,1995,1437" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="a01020_chemie" alt="a01020_chemie" title="Chemická laboratoř" href="javascript:roomClick('a01020_chemie')" coords="573,1013,1033,1550" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="a01014_strojovna" alt="a01014_strojovna" title="Strojovna" href="javascript:roomClick('a01014_strojovna')" coords="573,1550,1033,1928" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="schody_vchod" alt="schody_vchod" title="Schodiště" href="javascript:roomClick('schody_vchod')" coords="803,2368,1274,2931" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="wc" alt="wc" title="Toalety" href="javascript:roomClick('wc')" coords="1304,1662,2005,1933" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="uklid_1" alt="uklid_1" title="Úklidová místnost" href="javascript:roomClick('uklid_1')" coords="2031,1642,2348,1979" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="a01042_elektrotechnici_kancelar" alt="a01042_elektrotechnici_kancelar" title="Kancelář elektrotechniků" href="javascript:roomClick('a01042_elektrotechnici_kancelar')" coords="1279,2179,1872,2829" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="a01043_elektrotechnici_kancelar" alt="a01043_elektrotechnici_kancelar" title="Kancelář elektrotechniků" href="javascript:roomClick('a01043_elektrotechnici_kancelar')" coords="1882,2174,2261,2823" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="schody_tk3" alt="schody_tk3" title="Robotická laboratoř" href="javascript:roomClick('schody_tk3')" coords="2424,1627,2721,1995" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="a01039_tk3" alt="a01039_tk3" title="Učebna TK3" href="javascript:roomClick('a01039_tk3')" coords="2005,992,3043,1621" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="a01081_archiv" alt="a01081_archiv" title="Archiv" href="javascript:roomClick('a01081_archiv')" coords="2731,1637,3038,1985" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="a01044_administrativa_kancelar" alt="a01044_administrativa_kancelar" title="Kancelář administrativy" href="javascript:roomClick('a01044_administrativa_kancelar')" coords="2256,2179,2629,2818" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="a01047_prof_nosek_kancelar" alt="a01047_prof_nosek_kancelar" title="Kancelář prof. Noska" href="javascript:roomClick('a01047_prof_nosek_kancelar')" coords="3002,2179,3391,2823" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="a01048_vedouci_mti" alt="a01048_vedouci_mti" title="Vedoucí katedry MTI" href="javascript:roomClick('a01048_vedouci_mti')" coords="3401,2179,3785,2823" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="a01073_elektrotechnici_kancelar" alt="a01073_elektrotechnici_kancelar" title="Kancelář elektrotechniků" href="javascript:roomClick('a01073_elektrotechnici_kancelar')" coords="3304,552,3304,1054,3765,1049,3765,808,3637,798,3632,552" shape="polygon">
        <area data-toggle="tooltip" data-placement="top" id="a01075" alt="a01075" title="Místnost 01075" href="javascript:roomClick('a01075')" coords="3432,1228,3749,1550" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="a01076" alt="a01076" title="Místnost 01076" href="javascript:roomClick('a01076')" coords="3453,1570,3780,1985" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="a01072_elektrofyzici_kancelar" alt="a01072_elektrofyzici_kancelar" title="Kancelář elektrofyziků" href="javascript:roomClick('a01072_elektrofyzici_kancelar')" coords="3642,353,4005,793" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="uklid_2" alt="uklid_2" title="Úklidová místnost" href="javascript:roomClick('uklid_2')" coords="4926,358,5033,588" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="a01055_tk8" alt="a01055_tk8" title="Učebna TK8" href="javascript:roomClick('a01055_tk8')" coords="4517,793,4915,1248" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="a01077_knihovna_tk5" alt="a01077_knihovna_tk5" title="Knihovna TK5" href="javascript:roomClick('a01077_knihovna_tk5')" coords="4025,1263,4496,1627" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="a01078_tk6" alt="a01078_tk6" title="Učebna TK6" href="javascript:roomClick('a01078_tk6')" coords="4020,1627,4496,2164" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="a01053_rozvodna" alt="a01053_rozvodna" title="Rozvodna" href="javascript:roomClick('a01053_rozvodna')" coords="4557,2020,4921,2174" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="a01053_ap11" alt="a01053_ap11" title="Učebna AP11" href="javascript:roomClick('a01053_ap11')" coords="5043,1437,5437,2179" shape="rect">
        <area data-toggle="tooltip" data-placement="top" id="a01051_ap12" alt="a01051_ap12" title="Posluchárna AP12" href="javascript:roomClick('a01051_ap12')" coords="4547,2174,5463,2839" shape="rect">
    </map>
</main>

    <footer class="footer">
        <div class="container">
            <span class="text-muted">2020</span>
        </div>
    </footer>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script>window.jQuery || document.write('<script src="./js/jquery-3.5.1.js"><\/script>')</script>
<script type="text/javascript" src="./js/bootstrap.bundle.min.js"></script>
<script type="text/javascript" src="./js/imageMapResizer.min.js"></script>
<script>
    /**
     * TODO:
     * Přidat časomíru, jak dlouho trvalo od začátku hru dohrát
     * Přidat animaci chůze
     * Přidat modaly s úlohami
     * Přidat generování klíče
     * Přidat uvítací modal
     * Cílová místnost musí být nejprve uzamčena! Cílová místnost: a01073_elektrotechnici_kancelar
     */
    let currentRoom = "start",
        currentCoords = { //Relativně k výchozím hodnotám obrázku
        left: 1069,
        top: 2277
    };
    const coords = {
            start: {
                id: -1,
                left: 1069,
                top: 2277
            },
            a01081_architekt: {
                id: 0,
                door: {left: 1150, top: 1089},
                room: {left: 1053, top: 711},
                hallway: {left: 1166, top: 1115}
            },
            a01025_domovnik: {
                id: 1,
                door: {left: 1283, top: 1150},
                room: {left: 1728, top: 1207},
                hallway: {left: 1166, top: 1212}
            },
            a01020_chemie: {
                id: 2,
                door: {left: 1033, top: 1033},
                room: {left: 701, top: 1396},
                hallway: {left: 1166, top: 1452}
            },
            a01014_strojovna: {
                id: 3,
                door: {left: 1033, top: 1646},
                room: {left: 803, top: 1790},
                hallway: {left: 1166, top: 1754}
            },
            schody_vchod: {
                id: 4,
                door: {left: 1181, top: 2209},
                room: {left: 1196, top: 2439},
                hallway: {left: 1166, top: 2080}
            },
            a01042_elektrotechnici_kancelar: {
                id: 5,
                door: {left: 1416, top: 2250},
                room: {left: 1560, top: 2454},
                hallway: {left: 1411, top: 2080}
            },
            wc: {
                id: 6,
                door: {left: 1902, top: 2040},
                room: {left: 1902, top: 2040},
                hallway: {left: 1917, top: 2080}
            },
            a01043_elektrotechnici_kancelar: {
                id: 7,
                door: {left: 1979, top: 2240},
                room: {left: 2050, top: 2454},
                hallway: {left: 1979, top: 2080}
            },
            uklid_1: {
                id: 8,
                door: {left: 2071, top: 1979},
                room: {left: 2076, top: 1810},
                hallway: {left: 2076, top: 2080}
            },
            a01044_administrativa_kancelar: {
                id: 9,
                door: {left: 2373, top: 2275},
                room: {left: 2408, top: 2444},
                hallway: {left: 2367, top: 2080}
            },
            a01039_tk3: {
                id: 10,
                door: {left: 2398, top: 1708},
                room: {left: 2311, top: 1222},
                hallway: {left: 2398, top: 2080}
            },
            schody_tk3: {
                id: 11,
                door: {left: 2408, top: 1882},
                room: {left: 2424, top: 1795},
                hallway: {left: 2413, top: 2080}
            },
            a01081_archiv: {
                id: 12,
                door: {left: 2925, top: 1969},
                room: {left: 2874, top: 1805},
                hallway: {left: 2915, top: 2080}
            },
            a01047_prof_nosek_kancelar: {
                id: 13,
                door: {left: 3308, top: 2265},
                room: {left: 3170, top: 2500},
                hallway: {left: 3303, top: 2080}
            },
            a01076: {
                id: 14,
                door: {left: 3620, top: 1969},
                room: {left: 3620, top: 1969},
                hallway: {left: 3610, top: 2080}
            },
            a01048_vedouci_mti: {
                id: 15,
                door: {left: 3651, top: 2275},
                room: {left: 3605, top: 2475},
                hallway: {left: 3661, top: 2080}
            },
            a01078_tk6: {
                id: 16,
                door: {left: 4009, top: 1974},
                room: {left: 4285, top: 1948},
                hallway: {left: 3880, top: 2081}
            },
            a01077_knihovna_tk5: {
                id: 17,
                door: {left: 4004, top: 1483},
                room: {left: 4167, top: 1508},
                hallway: {left: 3880, top: 1488}
            },
            a01075: {
                id: 18,
                door: {left: 3753, top: 1406},
                room: {left: 3753, top: 1406},
                hallway: {left: 3880, top: 1386}
            },
            a01073_elektrotechnici_kancelar: {
                id: 19,
                door: {left: 3768, top: 890},
                room: {left: 3462, top: 951},
                hallway: {left: 3880, top: 920}
            },
            a01072_elektrofyzici_kancelar: {
                id: 20,
                door: {left: 3845, top: 762},
                room: {left: 3799, top: 588},
                hallway: {left: 3880, top: 808}
            },
            uklid_2: {
                id: 21,
                door: {left: 4975, top: 573},
                room: {left: 4980, top: 435},
                hallway: {left: 4975, top: 675}
            },
            a01055_tk8: {
                id: 22,
                door: {left: 4904, top: 1099},
                room: {left: 4745, top: 1038},
                hallway: {left: 4975, top: 1104}
            },
            a01053_ap11: {
                id: 23,
                door: {left: 5036, top: 1590},
                room: {left: 5108, top: 1754},
                hallway: {left: 4975, top: 1580}
            },
            a01053_rozvodna: {
                id: 24,
                door: {left: 4914, top: 2071},
                room: {left: 4694, top: 2091},
                hallway: {left: 4975, top: 2061}
            },
            a01051_ap12: {
                id: 25,
                door: {left: 4970, top: 2270},
                room: {left: 5082, top: 2490},
                hallway: {left: 4975, top: 2137}
            }
        },
        changeProperties = () => {
            //TODO: Omezit volání jQuery

            console.log("Called resize");
            $('map').imageMapResize();

            //První dva koordináty jsou vzdálenost zleva a vzdálenost shora
            let originalHeight = $('#map')[0].naturalHeight,
                originalWidth = $('#map')[0].naturalWidth,
                currentHeight = $('#map').height(),
                currentWidth = $('#map').width(),
                imageTop = $('#map').offset().top,
                imageLeft = $('#map').offset().left,
                robotHeight = $('#robot_head').height(),
                robotWidth = $('#robot_head').width(),
                scale = {
                    width: currentWidth / originalWidth,
                    height: currentHeight / originalHeight
                };

            console.log("Set coords to", currentCoords)

            // Nejprve nastavit šířku robota, potom jeho koordináty
            $('#robot_head').css({
                width: (scale.width * 300) + "px",
                left: imageLeft + (currentCoords.left * scale.width) - ($('#robot_head').width() / 2) + "px",
                top: imageTop + (currentCoords.top * scale.height) - ($('#robot_head').height() / 2) + "px"
            });

        },
        roomClick = (id) => {
            let originalHeight = $('#map')[0].naturalHeight,
                originalWidth = $('#map')[0].naturalWidth,
                currentHeight = $('#map').height(),
                currentWidth = $('#map').width(),
                imageTop = $('#map').offset().top,
                imageLeft = $('#map').offset().left,
                robotHeight = $('#robot_head').height(),
                robotWidth = $('#robot_head').width(),
                scale = {
                    width: currentWidth / originalWidth,
                    height: currentHeight / originalHeight
                };

            //console.log(coords[id]);
            if (currentRoom === "start") { //Hráč je na startu, je potřeba ho dostat do nové místnosti
                /**
                 * TODO:
                 * Robot zatím ignoruje postupnou cestu
                 * Bude potřeba přeprogramovat, jako v případě klasického přesunu ID chodby po chodbě (po startu se robot přesouvá na schody_vchod.hallway, id = 4
                 */
                //console.log("currentCords", currentCoords, "Moving to", "schody_vchod", "hallway", coords.schody_vchod.hallway);
                moveHead(
                    imageLeft + (currentCoords.left * scale.width) - ($('#robot_head').width() / 2), //oldleft
                    imageTop + (currentCoords.top * scale.height) - ($('#robot_head').height() / 2), //oldtop
                    imageLeft + (coords.schody_vchod.hallway.left * scale.width) - ($('#robot_head').width() / 2), //newleft
                    imageTop + (coords.schody_vchod.hallway.top * scale.height) - ($('#robot_head').height() / 2) //oldtop
                ).then(() => {
                    console.log("Moved to hallway");
                    currentCoords = coords.schody_vchod.hallway;
                    //console.log("currentCords", currentCoords, "Moving to", id, "hallway", coords[id].hallway);
                    moveHead(
                        imageLeft + (currentCoords.left * scale.width) - ($('#robot_head').width() / 2), //oldleft
                        imageTop + (currentCoords.top * scale.height) - ($('#robot_head').height() / 2), //oldtop
                        imageLeft + (coords[id].hallway.left * scale.width) - ($('#robot_head').width() / 2), //newleft
                        imageTop + (coords[id].hallway.top * scale.height) - ($('#robot_head').height() / 2) //oldtop
                    ).then(() => {
                        console.log("Moved to hallway, moving to door")
                        currentCoords = coords[id].hallway;
                        //console.log("currentCords", currentCoords, "Moving to", id, "door", coords[id].door);
                        moveHead(
                            imageLeft + (currentCoords.left * scale.width) - ($('#robot_head').width() / 2), //oldleft
                            imageTop + (currentCoords.top * scale.height) - ($('#robot_head').height() / 2), //oldtop
                            imageLeft + (coords[id].door.left * scale.width) - ($('#robot_head').width() / 2), //newleft
                            imageTop + (coords[id].door.top * scale.height) - ($('#robot_head').height() / 2) //oldtop
                        ).then(() => {
                            console.log("Moved to door, moving to room");
                            currentCoords = coords[id].door
                            //console.log("currentCords", currentCoords, "Moving to", id, "room", coords[id].room);
                            moveHead(
                                imageLeft + (currentCoords.left * scale.width) - ($('#robot_head').width() / 2), //oldleft
                                imageTop + (currentCoords.top * scale.height) - ($('#robot_head').height() / 2), //oldtop
                                imageLeft + (coords[id].room.left * scale.width) - ($('#robot_head').width() / 2), //newleft
                                imageTop + (coords[id].room.top * scale.height) - ($('#robot_head').height() / 2) //oldtop
                            ).then(() => {
                                currentCoords = coords[id].room;
                                //console.log("currentCords", currentCoords, "Moved to room", id);
                                currentRoom = id;
                            });
                        });
                    });
                });
            } else {
                if (coords[currentRoom].id === coords[id].id) {
                    alert("Jsi ve stejné místnosti");
                } else if (coords[currentRoom].id < coords[id].id) { //Pokud je ID nové místnosti větší, jak ID původní místnosti
                    //TODO: Přesun do místnosti lze řešit rekurzivně: Jsi již v místnosti? Ne. Přesuň se do místnosti s vyšším ID
                    alert("Půjdeš postupně po chodbě do místnosti s vyšším ID");
                } else { //Jinak, pokud je ID nové místností nižší jak ID původní místnosti
                    alert("Půjdeš postupně po chodbě do místnosti s nižším ID");
                }
            }

            /*let tk6_coords = {
                left: 2369,
                top: 2047
            }*/

            //moveHead(imageLeft + (currentCoords.left * scale.width) - ($('#robot_head').width() / 2), imageTop + (currentCoords.top * scale.height) - ($('#robot_head').height() / 2), imageLeft + (tk6_coords.left * scale.width) - ($('#robot_head').width() / 2), imageTop + (tk6_coords.top * scale.height) - ($('#robot_head').height() / 2));
            //currentCoords = tk6_coords;

        },
        moveHead = (oldLeft, oldTop, newLeft, newTop) => {
            return new Promise((resolve, reject) => {
                const elem = document.getElementById("robot_head");
                let posLeft = oldLeft,
                    posTop = oldTop,
                    id = setInterval(manipulate, 5);

                //console.log(oldLeft < newLeft)

                function manipulate() {
                    if (oldLeft < newLeft && Math.abs(newLeft - posLeft) >= 1) {
                        //console.log("moved left");
                        posLeft++;
                        elem.style.left = posLeft + "px";
                    } else if (oldLeft > newLeft && Math.abs(newLeft - posLeft) >= 1) {
                        //console.log("moved right");
                        posLeft--;
                        elem.style.left = posLeft + "px";
                    } else {
                        //console.log("set final left");
                        posLeft = newLeft;
                        elem.style.left = posLeft + "px";
                    }

                    if (oldTop < newTop && Math.abs(newTop - posTop) >= 1) {
                        //console.log("moved top");
                        posTop++;
                        elem.style.top = posTop + "px";
                    } else if (oldTop > newTop && Math.abs(newTop - posTop) >= 1) {
                        //console.log("moved down");
                        posTop--;
                        elem.style.top = posTop + "px";
                    } else {
                        //console.log("set final top");
                        posTop = newTop;
                        elem.style.top = posTop + "px";
                    }

                    if (posLeft === newLeft && posTop === newTop) {
                        clearInterval(id);
                        resolve(true);
                    }
                }
            });
        };

    window.addEventListener('resize', changeProperties);
    window.addEventListener('load', changeProperties);
    window.addEventListener('mousemove', e => {
        let tooltip = $("div[id^='tooltip']");
        if (tooltip.length > 0) {
            let mouseX = e.pageX;
            let mouseY = e.pageY;
            tooltip.css({left: mouseX, top: mouseY, transform: "translate3d(-" + tooltip[0].firstChild.style.left +", -50px, 0px)", "pointer-events": "none"});
        }
    });

    //Při načtení dokumentu
    document.addEventListener('DOMContentLoaded', () => {
        window.setTimeout(changeProperties, 50);
        $('[data-toggle="tooltip"]').tooltip();
    });
    console.log("Added events");

</script>

</body>
</html>
